#########################
# MORTALITY PREPARATION #
#########################


m1 <- read_rds("https://github.com/ACC1240138/FONDECYT-REGULAR-/raw/main/rawdata/defunciones1.RDS") 
m2 <- read_rds("https://github.com/ACC1240138/FONDECYT-REGULAR-/raw/main/rawdata/defunciones2.RDS") 

def <- bind_rows(m1,m2)
rm(m1,m2)

###########
# AFF = 1 #
###########

def <- def %>%
  mutate(des_men = as.integer(DIAG1 %in% c("F100", "F101", "F102", "F103", "F104", "F105", "F106", "F107", "F108", "F109")),
         deg_nerv = ifelse(DIAG1 == "G312",1,0),
         polineu = ifelse(DIAG1 == "G621",1,0),
         cardiomio = ifelse(DIAG1 == "I426",1,0),
         pancreati_oh = ifelse(DIAG1 == "K860",1,0),
         gastrit = ifelse(DIAG1 == "K292",1,0),
         enven_acc = as.integer(DIAG2 %in% c("X450", "X451", "X452", "X453", "X454", "X455", "X456", "X457", "X458", "X459")),
         enven_int = as.integer(DIAG2 %in% c("X650", "X651", "X652", "X653", "X654", "X655", "X656", "X657", "X658", "X659")),
         enven_indet = as.integer(DIAG2 %in% c("Y150", "Y151", "Y152", "Y153", "Y154", "Y155", "Y156", "Y157", "Y158", "Y159")),
         wernicke = ifelse(DIAG1 == "E512",1,0),
         mortdiroh = case_when(des_men == 1 ~ 1,
                               deg_nerv == 1 ~ 2,
                               polineu == 1 ~ 3,
                               cardiomio == 1 ~ 4,
                               pancreati_oh == 1 ~ 5,
                               gastrit == 1 ~6,
                               enven_acc == 1 ~7,
                               enven_int == 1 ~ 8,
                               enven_indet == 1 ~9, 
                               wernicke == 1 ~ 10,
                               TRUE~0))

################################
# PARTIALLY ATTRIBUTABLE TO OH #
################################

def <- def %>% 
  mutate(epilep = if_else(DIAG1 %in% c("G400", "G401", "G402", "G403", "G404", "G405", "G406", "G407", "G408", "G409", 
                                       "G410", "G411", "G412", "G413", "G414", "G415", "G416", "G417", "G418", "G419"), 1, 0),
         ave_hem = if_else(DIAG1 %in% c("I600", "I601", "I602", "I603", "I604", "I605", "I606", "I607", "I608", "I609", 
                                        "I610", "I611", "I612", "I613", "I614", "I615", "I616", "I617", "I618", "I619", 
                                        "I620", "I621", "I622", "I623", "I624", "I625", "I626", "I627", "I628", "I629"), 1, 0),
         ave_isq = if_else(DIAG1 %in% c("I630", "I631", "I632", "I633", "I634", "I635", "I636", "I637", "I638", "I639", 
                                        "I640", "I641", "I642", "I643", "I644", "I645", "I646", "I647", "I648", "I649", 
                                        "I650", "I651", "I652", "I653", "I654", "I655", "I656", "I657", "I658", "I659", 
                                        "I660", "I661", "I662", "I663", "I664", "I665", "I666", "I667", "I668", "I669"), 1, 0),
         hiperten = if_else(DIAG1 %in% c("I100", "I101", "I102", "I103", "I104", "I105", "I106", "I107", "I108", "I109", 
                                         "I110", "I111", "I112", "I113", "I114", "I115", "I116", "I117", "I118", "I119", 
                                         "I120", "I121", "I122", "I123", "I124", "I125", "I126", "I127", "I128", "I129", 
                                         "I130", "I131", "I132", "I133", "I134", "I135", "I136", "I137", "I138", "I139", 
                                         "I140", "I141", "I142", "I143", "I144", "I145", "I146", "I147", "I148", "I149", 
                                         "I150", "I151", "I152", "I153", "I154", "I155", "I156", "I157", "I158", "I159"), 1, 0),
         ca_mama = if_else(DIAG1 %in% c("C500", "C501", "C502", "C503", "C504", "C505", "C506", "C507", "C508", "C509"), 1, 0),
         ca_colon = if_else(DIAG1 %in% c("C180", "C181", "C182", "C183", "C184", "C185", "C186", "C187", "C188", "C189"), 1, 0),
         ca_colorec = ifelse(DIAG1 == "C19X",1,0),
         ca_larin = if_else(DIAG1 %in% c("C320", "C321", "C322", "C323", "C324", "C325", "C326", "C327", "C328", "C329"), 1, 0),
         ca_higa = if_else(DIAG1 %in% c("C220", "C221", "C222", "C223", "C224", "C225", "C226", "C227", "C228", "C229"), 1, 0),
         ca_esofa = if_else(DIAG1 %in% c("C150", "C151", "C152", "C153", "C154", "C155", "C156", "C157", "C158", "C159"), 1, 0),
         ca_boca = if_else(DIAG1 %in% c("C000", "C001", "C002", "C003", "C004", "C005", "C006", "C007", "C008", "C009",
                                        "C010", "C011", "C012", "C013", "C014", "C015", "C016", "C017", "C018", "C019",
                                        "C020", "C021", "C022", "C023", "C024", "C025", "C026", "C027", "C028", "C029",
                                        "C030", "C031", "C032", "C033", "C034", "C035", "C036", "C037", "C038", "C039",
                                        "C040", "C041", "C042", "C043", "C044", "C045", "C046", "C047", "C048", "C049",
                                        "C050", "C051", "C052", "C053", "C054", "C055", "C056", "C057", "C058", "C059",
                                        "C060", "C061", "C062", "C063", "C064", "C065", "C066", "C067", "C068", "C069",
                                        "C090", "C091", "C092", "C093", "C094", "C095", "C096", "C097", "C098", "C099",
                                        "C100", "C101", "C102", "C103", "C104", "C105", "C106", "C107", "C108", "C109",
                                        "C120", "C121", "C122", "C123", "C124", "C125", "C126", "C127", "C128", "C129",
                                        "C130", "C131", "C132", "C133", "C134", "C135", "C136", "C137", "C138", "C139",
                                        "C140", "C141", "C142", "C143", "C144", "C145", "C146", "C147", "C148", "C149"), 1, 0),
         ca_recto = ifelse(DIAG1 == "C20X"),
         arritmias = ifelse(DIAG1 == "I48X"),
         diabetes = if_else(DIAG1 %in% c("E110", "E111", "E112", "E113", "E114", "E115", "E116", "E117", "E118", "E119"), 1, 0),
         ihd = if_else(DIAG1 %in% c("I200", "I201", "I202", "I203", "I204", "I205", "I206", "I207", "I208", "I209",
                                    "I210", "I211", "I212", "I213", "I214", "I215", "I216", "I217", "I218", "I219",
                                    "I220", "I221", "I222", "I223", "I224", "I225", "I226", "I227", "I228", "I229",
                                    "I230", "I231", "I232", "I233", "I234", "I235", "I236", "I237", "I238", "I239",
                                    "I240", "I241", "I242", "I243", "I244", "I245", "I246", "I247", "I248", "I249",
                                    "I250", "I251", "I252", "I253", "I254", "I255", "I256", "I257", "I258", "I259"), 1, 0),
         neumonia = if_else(DIAG1 %in% c("J100", "J110", "J111", "J120", "J121", "J122", "J123", "J124", "J125", "J126", 
                                         "J127", "J128", "J129", "J130", "J131", "J132", "J133", "J134", "J135", "J136", 
                                         "J137", "J138", "J139", "J140", "J141", "J142", "J143", "J144", "J145", "J146", 
                                         "J147", "J148", "J149", "J150", "J151", "J152", "J153", "J154", "J155", "J156", 
                                         "J157", "J158", "J159", "J160", "J161", "J162", "J163", "J164", "J165", "J166", 
                                         "J167", "J168", "J169", "J170", "J171", "J172", "J173", "J174", "J175", "J176", 
                                         "J177", "J178", "J179", "J180", "J181", "J182", "J183", "J184", "J185", "J186", 
                                         "J187", "J188", "J189"), 1, 0),
         TBC = if_else(DIAG1 %in% c("A150", "A151", "A152", "A153", "A154", "A156", "A159", "A160", "A161", "A162", 
                                    "A163", "A164", "A165", "A169", "A170", "A171", "A178", "A179", "A180", "A181", 
                                    "A182", "A183", "A184", "A188", "A190", "A191", "A198", "A199"), 1, 0),
         pancreati = if_else(DIAG1 %in% c("K850", "K851", "K852", "K853", "K854", "K855", "K856", "K857", "K858", "K859", "K861"), 1, 0),
         cirrosis = if_else(DIAG1 %in% c("K700", "K701", "K702", "K703", "K704", "K705", "K706", "K707", "K708", "K709",
                                         "K740", "K741", "K742", "K743", "K744", "K745", "K746", "K760", "K769"), 1, 0),
         )


# PREGUNTAR: - Motor vehicle accidents, Accidental poisoning, Falls,Fires,Drowning,
# Other Unintentional injuries, Self-inflicted injuries, Homicide, Other intentional injuries

# ES DIAG1 O DIAG2?
